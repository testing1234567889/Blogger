<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>APK Card</title>

<style>
/* ==== BASE KAMU (dipertahankan) ===================================== */
/* Reset + box-sizing */
* { box-sizing: border-box; margin:0; padding:0; }

/* Card utama */
.apk-post-card {
  width: 95%;
  max-width: 860px;
  margin: 20px auto;
  background: #1a1a1a;
  color: #fff;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  border: 1px solid rgba(255,255,255,0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.apk-post-card:hover { transform: translateY(-2px); box-shadow:0 10px 25px rgba(0,0,0,0.4); }

/* Header */
.apk-header { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
.apk-icon { width:80px; height:80px; border-radius:16px; object-fit:cover; }
.apk-title-area { flex:1; }
.apk-title { font-size:1.5rem; font-weight:600; display:flex; align-items:center; gap:6px; }
.verified-icon { width:18px; height:18px; }
.apk-developer { font-size:0.9rem; color:#aaa; }

/* Fitur MOD */
.apk-tags ul {
  list-style: none; padding: 0; margin: 0;
  display: flex; flex-direction: column; gap: 6px;
}
.apk-tags li {
  display: flex; align-items: center; gap: 6px;
  font-size: 0.95rem; font-weight: 600; color: #f5f5f5;
  font-family: 'Inter', sans-serif;
}
.apk-tags li svg { width: 16px; height: 16px; fill: #00ff88; }

/* Rating + stats */
.stat-box {
  display:flex; justify-content:space-between;
  background-color:#1f1f1f;
  border-radius:12px; padding:15px; margin:20px 0;
  text-align:center;
}
.stat-item { flex:1; border-right:1px solid #333; padding:0 10px; }
.stat-item:last-child { border-right:none; }
.stat-value { font-size:20px; font-weight:bold; color:#fff; }
.stat-label { font-size:12px; color:#aaa; }

/* Section title */
.apk-section-title {
  font-size:1.1rem;
  margin: 12px 0 6px;
  padding-left:10px;
  border-left:4px solid #00ffe0;
  color:#eee;
}

/* Info APK */
.apk-info { 
  width: 100%; 
  border-collapse: collapse; 
  margin-top: 12px; 
  font-size: 0.8rem;
  table-layout: fixed; 
}
.apk-info th, 
.apk-info td { 
  padding: 6px 8px; 
  background: transparent;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.apk-info th {
  font-weight: 600;
  color: #ccc;
  text-align: left;
  width: 50%;
}
.apk-info td {
  font-weight: 400;
  color: #f5f5f5;
  text-align: left;
  width: 72%;
}
.apk-info th svg {
  flex-shrink: 0;
  fill: currentColor;
}
.apk-info td a {
  color: #4fc3f7;
  text-decoration: none;
  white-space: nowrap;
}
.apk-info td a:hover { 
  color: #00b0ff; 
  text-decoration: underline;
}
.apk-info th .icon-text {
  display: flex;
  align-items: center;
  gap: 6px;
}
.apk-info th svg {
  flex-shrink: 0;
  width: 16px;
  height: 16px;
  fill: currentColor;
}

/* Deskripsi */
.apk-description {
  font-family: 'Segoe UI', Roboto, sans-serif;
  font-size: 0.95rem; line-height: 1.6; color: #eaeaea;
  background-color: #1e1e1e;
  padding: 12px 16px; border-radius: 12px;
  text-align: justify; word-break: break-word;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.15);
}
.apk-description a { color: #4fc3f7; text-decoration: underline; }
.apk-description a:hover { color: #00b0ff; text-decoration: none; }

/* Screenshots */
.apk-screenshots { display: flex; gap: 6px; overflow-x: auto; padding: 6px 0; scroll-snap-type: x mandatory; }
.apk-screenshots img {
  height: 180px; border-radius: 10px; flex-shrink: 0; cursor: pointer;
  transition: transform 0.25s ease, filter 0.25s ease, box-shadow 0.25s ease, opacity 0.25s ease;
  opacity: 0; transform: scale(0.97);
}
.apk-screenshots img.loaded { opacity: 1; transform: scale(1); }
.apk-screenshots img:hover {
  transform: scale(1.08);
  filter: brightness(1.1) contrast(1.35) saturate(1.25);
}
.apk-screenshots img { scroll-snap-align: center; }

/* Buttons */
.apk-buttons { margin-top:24px; text-align:center; display:flex; flex-direction:column; align-items:center; gap:12px; }
.download-button {
  background-color:#1e293b; color:#f8fafc; padding:14px 28px;
  font-size:1rem; font-weight:600; border-radius:10px; border:1px solid #334155;
  display:inline-flex; align-items:center; gap:10px; cursor:pointer;
  text-decoration:none; transition:0.2s all;
}
.download-button:hover { background-color:#334155; transform:translateY(-2px); }

/* Spinner */
.spinner-area { display:none; flex-direction:column; align-items:center; gap:6px; }
.spinner {
  width:28px; height:28px; border:3px solid rgba(0,255,224,0.25);
  border-top-color:#00ffe0; border-radius:50%;
  animation:spin 0.8s linear infinite;
}
.downloading-text { font-size:0.9rem; color:#00ffe0; font-weight:500; }
@keyframes spin { to { transform:rotate(360deg); } }

/* Lightbox */
.lightbox {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(10px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.lightbox img {
  max-width: calc(100% - 120px);
  max-height: 80vh;
  border-radius: 12px;
  box-shadow: 0 0 25px rgba(0,255,224,0.25);
  transition: transform 0.3s ease, opacity 0.3s ease;
  margin: auto;
  display: block;
}

/* Arrow style */
.lightbox-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.45);
  border: none;
  cursor: pointer;
  pointer-events: auto;
  color: #fff;
  width: 64px; 
  height: 64px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease, transform 0.2s ease;
}
.lightbox-arrow:hover {
  background: rgba(0,0,0,0.65);
  transform: translateY(-50%) scale(1.1);
}
.lightbox-arrow svg {
  width: 32px; 
  height: 32px;
  stroke-width: 2.8;
}
.left-arrow { left: 10px; }
.right-arrow { right: 10px; }

@media (max-width: 768px) {
  .lightbox-arrow { width: 52px; height: 52px; }
  .lightbox-arrow svg { width: 26px; height: 26px; }
}
@media (max-width: 480px) {
  .lightbox-arrow { width: 46px; height: 46px; }
  .lightbox-arrow svg { width: 22px; height: 22px; }
}
.lightbox-nav {
  position: absolute;
  top: 50%;
  left: 0; right: 0;
  transform: translateY(-50%);
  pointer-events: none;
}
.lightbox-close {
  position: absolute;
  top: 20px;
  right: 20px;
  background: rgba(0,0,0,0.6);
  border: none;
  color: white;
  font-size: 28px;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  cursor: pointer;
  z-index: 10000;
}

/* ==== TAMBAHAN ANTI & LIGHTBOX LANJUTAN (dari versi sebelumnya) ===== */
/* Anti tap-biru + overscroll chain break */
:root { --tap-clear: rgba(0,0,0,0); scrollbar-gutter: stable both-edges; }
html,body,*,a,button,img,svg { -webkit-tap-highlight-color: var(--tap-clear); }
html,body { overscroll-behavior: none; }
a,button { -webkit-appearance:none; appearance:none; }
button,.download-button,.lightbox-arrow,.lightbox-close{
  outline:none!important; box-shadow:none!important;
  touch-action:manipulation; -webkit-user-select:none; user-select:none;
}

/* Hide <img> dalam lightbox: pakai viewport layer */
#lightboxImage{ display:none !important; }

/* Viewport & layers untuk pinch-zoom/pan & crossfade/slide */
.lb-viewport{
  position:absolute; inset:0; margin:auto;
  width:calc(100% - 120px); max-width:100%;
  height:80vh; max-height:80vh;
  border-radius:12px; overflow:hidden;
  will-change: transform;
  touch-action:none;
  cursor: grab;
  transform:translateZ(0); contain:layout paint style;
  overscroll-behavior:contain;
}
.lb-viewport:active{ cursor: grabbing; }
.lb-layer{
  position:absolute; inset:0;
  background-repeat:no-repeat;
  background-position:center center;
  background-size:contain;
  opacity:0;
  transition: opacity .22s ease, transform .22s cubic-bezier(.2,.7,.2,1);
  will-change: opacity, transform;
}
.lb-layer.show{ opacity:1; }

/* Hint cursor saat tepi aktif untuk slide (zoom mode) */
.lb-viewport.can-edge-left,
.lb-viewport.can-edge-right{ cursor: ew-resize; }

/* Optional: animasi halus untuk teks ‚ÄúLink rusak?‚Äù */
@keyframes smoothBlink { 0%{opacity:.75} 50%{opacity:1} 100%{opacity:.75} }
</style>
</head>

<body>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" style="display:none;">
  <div class="lightbox-nav">
    <button class="lightbox-arrow left-arrow">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
        <path d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    <button class="lightbox-arrow right-arrow">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
        <path d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
  <img id="lightboxImage" src="" />
  <button id="closeBtn" class="lightbox-close">‚úï</button>
</div>

<!-- BEGIN APK CARD GENERATED -->
<div class="apk-post-card">
  <div style="display:flex;gap:12px;align-items:center;">
    <img alt="App Icon" src="https://play-lh.googleusercontent.com/gGsUxZByKdJg-sdb2D7lP-opRVGr26vqJUPbdFAXf0kNdBzSeOYQUmsjeLDHwO1AKmp0=w240-h480-rw" style="width:64px;height:64px;border-radius:14px;"/>
    <div>
      <div class="apk-title">Drama Queen<img alt="Verified" class="verified-icon" src="https://upload.wikimedia.org/wikipedia/commons/e/e4/Twitter_Verified_Badge.svg" style="width:18px;height:18px;"/></div>
      <div class="apk-developer"><a href="https://play.google.com/store/apps/developer?id=Fun+Technologies+Studio&hl=id" target="_blank" rel="noopener noreferrer">Fun Technologies Studio</a></div>
    </div>
  </div>

  <div class="stat-box">
    <div class="stat-item"><div class="stat-value">4,8</div><div class="stat-label">Rating</div></div>
    <div class="stat-item"><div class="stat-value">181</div><div class="stat-label">Ulasan</div></div>
    <div class="stat-item"><div class="stat-value">5 rb+</div><div class="stat-label">Unduhan</div></div>
  </div>

  <div class="apk-section-title"><b>Deskripsi</b></div>
  <div class="apk-description">Drama Queen adalah aplikasi streaming drama yang menghadirkan berbagai pilihan Drama Korea (Drakor), Drama China (Drachin), dan drama Asia lainnya langsung di genggamanmu. Nikmati pengalaman menonton yang nyaman, cepat, dan lengkap ‚Äî kapan pun, di mana pun!

Alternative Tupai Drama</div>

  <div class="apk-section-title"><b>Screenshot</b></div>
  <div class="apk-screenshots"><img src="https://play-lh.googleusercontent.com/yn4UAvtMvFZ_sl9vbd5T_TsfSbiSzB6NFbwqgxyybp1rGhI5KLtgjNnzhnDZOscGDA=w2560-h1440-rw" alt="Screenshot 1" onclick="openLightbox(0)"><img src="https://play-lh.googleusercontent.com/D642dn5I4aNS_rtDcEi-l8C0MfKU9SYn64Es1xRV3D0NS0x8Mp1L25VFX_06s649IPXM=w2560-h1440-rw" alt="Screenshot 2" onclick="openLightbox(1)"><img src="https://play-lh.googleusercontent.com/jCRDMCnCAkP2Z1gRm09uARPUkmapnJW94Nma1j5R5XDUYuR91ITbc9liBnPj80mUS24=w2560-h1440-rw" alt="Screenshot 3" onclick="openLightbox(2)"><img src="https://i.ibb.co.com/XkbXBsg7/Screenshot-20251026-015238-Drama-Queen.png" alt="Screenshot 4" onclick="openLightbox(3)"></div>

  <div class="apk-section-title"><b>Info APK</b></div>
  <table class="apk-info">
    <tr><th><div class="icon-text"><svg width="16" height="16" viewBox="0 0 24 24"><path d="M9 3h6v2H9zM5 7h14v2H5zM7 11h10v2H7zM9 15h6v2H9zM11 19h2v2h-2z"/></svg>Versi</div></th><td>0.1.21</td></tr>
    <tr><th><div class="icon-text"><svg width="16" height="16" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 17H5V8h14v12z"/></svg>Update</div></th><td>27 Okt 2025</td></tr>
    <tr><th><div class="icon-text"><svg width="16" height="16" viewBox="0 0 24 24"><path d="M17.6 9.48l1.43-2.49a.5.5 0 0 0-.86-.5l-1.45 2.52A8.14 8.14 0 0 0 12 8c-1.7 0-3.28.53-4.72 1.5L5.83 6.49a.5.5 0 0 0-.86.5l1.42 2.49A7.94 7.94 0 0 0 4 15v5a1 1 0 0 0 1 1h2v-6h2v6h6v-6h2v6h2a1 1 0 0 0 1-1v-5c0-2.23-.91-4.24-2.4-5.52z"/></svg>Minimal Android</div></th><td>6</td></tr>
    <tr><th><div class="icon-text"><svg width="16" height="16" viewBox="0 0 24 24"><path d="M9 3h6v2h2v2h2v6h-2v2h-2v2H9v-2H7v-2H5V7h2V5h2V3zM7 9v6h10V9H7z"/></svg>CPU Support</div></th><td>v8a</td></tr>
    <tr><th><div class="icon-text"><svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="7" r="4"/><path d="M5.5 22a7.5 7.5 0 0 1 13 0"/></svg>Developer</div></th><td><a href="https://play.google.com/store/apps/developer?id=Fun+Technologies+Studio&hl=id" target="_blank" rel="noopener">Fun Technologies Studio</a></td></tr>
    <tr><th><div class="icon-text"><svg width="16" height="16" viewBox="0 0 24 24"><path d="M10 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8l-2-2z"/></svg>Kategori</div></th><td>Hiburan</td></tr>    
  </table>

  <div class="apk-section-title"><b>Fitur MOD</b></div>
  <div class="apk-tags"><ul style="list-style:none;padding:0;margin:1em 0;">
      <li style="display:flex;align-items:center;gap:6px;font-size:0.95rem;font-weight:600;color:#f5f5f5;">
        <svg width="16" height="16" viewBox="0 0 24 24"><path d="M20.285 6.709l-11.285 11.292-5.285-5.292 1.414-1.414 3.871 3.878 9.871-9.878z"/></svg>
        PREMIUM
      </li>
    </ul></div>

  <div class="apk-buttons">
    <a class="download-button" href="#" onclick="startDownload(event,'https://shorturl.at/fx5h3')">‚¨á Download (28.2MB)</a>
    <div class="spinner-area"><div class="spinner"></div><div class="downloading-text">Mengunduh file‚Ä¶</div></div>
    <p style="margin-top:12px;font-size:0.7rem;color:rgba(255,255,255,0.7);font-weight:500;animation:smoothBlink 3s ease-in-out infinite;">
      üö® Link rusak? <a href="https://t.me/key_generatebot" target="_blank" style="color:dodgerblue;font-weight:500;">Hubungi saya di Telegram</a>.
    </p>
  </div>
</div>
<!-- END APK CARD -->

<script>
/* ===================== ANTI SEMUANYA ===================== */
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  const blocked = ['F12','PrintScreen'];
  const ctrl = ['c','u','s','a'];
  if (blocked.includes(e.key) || (e.ctrlKey && ctrl.includes(e.key.toLowerCase()))) e.preventDefault();
});
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('dragstart', e => e.preventDefault());

/* ===================== Download + Spinner ===================== */
function startDownload(event, url){
  event.preventDefault();
  const button = event.currentTarget;
  const container = button.closest(".apk-buttons");
  const spinnerArea = container.querySelector(".spinner-area");
  button.style.display = "none";
  spinnerArea.style.display = "flex";
  setTimeout(()=>{
    spinnerArea.style.display = "none";
    button.style.display = "inline-flex";
    window.open(url,"_blank");
  }, 2000);
}

/* ===================== Lightbox Lanjutan (pinch, pan, edge-slide) ===================== */
let currentIndex=0, naturalW=1, naturalH=1;
const lightbox = document.getElementById("lightbox");
const leftArrow = document.querySelector(".left-arrow");
const rightArrow = document.querySelector(".right-arrow");
const closeBtn = document.getElementById("closeBtn");

/* Buat viewport & 2 layer (background-image) */
const viewport = document.createElement('div');
viewport.className = 'lb-viewport';
const layerA = document.createElement('div');
const layerB = document.createElement('div');
layerA.className = 'lb-layer';
layerB.className = 'lb-layer';
viewport.appendChild(layerA);
viewport.appendChild(layerB);
lightbox.insertBefore(viewport, closeBtn);

/* Lazy + loaded class untuk thumbnails */
document.querySelectorAll(".apk-screenshots img").forEach(img=>{
  img.setAttribute('loading','lazy');
  if(img.complete) img.classList.add("loaded");
  else img.addEventListener("load", ()=> img.classList.add("loaded"));
});

function updateArrows(screens){
  leftArrow.style.display = currentIndex===0?'none':'flex';
  rightArrow.style.display = currentIndex===screens.length-1?'none':'flex';
}

/* Preload ukuran asli */
function preload(src){
  return new Promise((resolve)=>{
    const im = new Image();
    im.decoding='async';
    im.onload=()=> resolve({w:im.naturalWidth||1, h:im.naturalHeight||1});
    im.onerror=()=> resolve({w:1,h:1});
    im.src = src;
    if(im.decode){
      im.decode().then(()=>resolve({w:im.naturalWidth||1,h:im.naturalHeight||1}))
                 .catch(()=>resolve({w:im.naturalWidth||1,h:im.naturalHeight||1}));
    }
  });
}

/* Lock scroll saat lightbox terbuka */
function lockScroll(lock){
  const html = document.documentElement;
  if(lock){
    const sbw = window.innerWidth - html.clientWidth;
    if(sbw>0) document.body.style.paddingRight = sbw + 'px';
    html.style.overflow = 'hidden';
  } else {
    html.style.overflow = '';
    document.body.style.paddingRight = '';
  }
}

/* Zoom & Pan */
let zoom=1, panX=0, panY=0, isPanning=false, startPX=0, startPY=0;
let baseW=0, baseH=0;

function computeBaseSize(){
  const vpW = viewport.clientWidth;
  const vpH = viewport.clientHeight;
  const ratio = Math.min(vpW / naturalW, vpH / naturalH, 1);
  baseW = naturalW * ratio; baseH = naturalH * ratio;
}
function clampPan(){
  const maxX=Math.max(0,(baseW*zoom-baseW)/2);
  const maxY=Math.max(0,(baseH*zoom-baseH)/2);
  panX=Math.max(-maxX,Math.min(maxX,panX));
  panY=Math.max(-maxY,Math.min(maxY,panY));
}
function applyTransform(){
  clampPan();
  viewport.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
}
function resetView(){
  zoom=1; panX=0; panY=0; isPanning=false;
  viewport.style.transform = 'translate(0px, 0px) scale(1)';
}

/* Pan hanya saat zoom>1 */
viewport.addEventListener('pointerdown', (e)=>{
  if(zoom===1) return;
  isPanning=true;
  startPX=e.clientX-panX; startPY=e.clientY-panY;
  viewport.setPointerCapture(e.pointerId);
  viewport.style.cursor="grabbing";
});
viewport.addEventListener('pointermove', (e)=>{
  if(!isPanning) return;
  panX=e.clientX-startPX; panY=e.clientY-startPY;
  applyTransform();
});
['pointerup','pointercancel','pointerleave'].forEach(ev=>{
  viewport.addEventListener(ev, (e)=>{
    if(!isPanning) return;
    isPanning=false;
    try{ viewport.releasePointerCapture(e.pointerId); }catch(_){}
    viewport.style.cursor="grab";
  });
});

/* Pinch zoom 2 jari (touch) */
const activePtrs=new Map();
let pinchStartDist=0, pinchStartZoom=1;
viewport.addEventListener('pointerdown',(e)=>{
  if(e.pointerType==='touch'){ activePtrs.set(e.pointerId,{x:e.clientX,y:e.clientY}); }
});
viewport.addEventListener('pointermove',(e)=>{
  if(e.pointerType==='touch' && activePtrs.has(e.pointerId)){
    activePtrs.set(e.pointerId,{x:e.clientX,y:e.clientY});
    if(activePtrs.size===2){
      const pts=[...activePtrs.values()];
      const d=Math.hypot(pts[0].x-pts[1].x, pts[0].y-pts[1].y);
      if(!pinchStartDist){ pinchStartDist=d; pinchStartZoom=zoom; }
      let nz = Math.min(3, Math.max(1, pinchStartZoom*(d/pinchStartDist)));
      zoom=nz; applyTransform();
    }
  }
});
['pointerup','pointercancel','pointerleave'].forEach(ev=>{
  viewport.addEventListener(ev,(e)=>{
    if(e.pointerType==='touch'){
      activePtrs.delete(e.pointerId);
      if(activePtrs.size<2){ pinchStartDist=0; }
    }
  });
});

/* Open / Close */
function setLayerBG(el, src){ el.style.backgroundImage = `url("${src}")`; }
async function openLightbox(index){
  const screens = document.querySelectorAll(".apk-screenshots img");
  if(!screens.length) return;
  currentIndex = index;
  const src = screens[currentIndex].src;

  const sz = await preload(src);
  naturalW = sz.w; naturalH = sz.h;

  lightbox.style.display = "flex";
  lockScroll(true);

  resetView(); computeBaseSize();
  setLayerBG(layerA, src);
  layerA.classList.add('show');
  layerB.classList.remove('show');

  updateArrows(screens);
  prefetchNeighbor();
}
function closeLightbox(){
  lightbox.style.display = "none";
  lockScroll(false);
}

/* Crossfade antar gambar */
let currentIsA = true;
async function crossfadeTo(src){
  const sz = await preload(src);
  naturalW = sz.w; naturalH = sz.h;
  computeBaseSize();

  const next = currentIsA ? layerB : layerA;
  const curr = currentIsA ? layerA : layerB;

  setLayerBG(next, src);
  next.getBoundingClientRect();
  next.classList.add('show');
  curr.classList.remove('show');

  currentIsA = !currentIsA;
}

/* Navigasi dasar */
function nextImage(){
  const screens=document.querySelectorAll(".apk-screenshots img");
  if(currentIndex < screens.length-1){
    currentIndex++;
    crossfadeTo(screens[currentIndex].src);
    updateArrows(screens);
    prefetchNeighbor();
  }
}
function prevImage(){
  const screens=document.querySelectorAll(".apk-screenshots img");
  if(currentIndex > 0){
    currentIndex--;
    crossfadeTo(screens[currentIndex].src);
    updateArrows(screens);
    prefetchNeighbor();
  }
}

/* Binding tombol */
leftArrow.addEventListener("click", e=>{ e.stopPropagation(); prevImage(); });
rightArrow.addEventListener("click", e=>{ e.stopPropagation(); nextImage(); });

/* Hanya tombol ‚ùå yang boleh close (backdrop & ESC diblok) */
function handleClose(e){
  e.preventDefault?.(); e.stopPropagation?.();
  closeLightbox();
}
closeBtn.addEventListener("click", handleClose);

/* Blok backdrop click menutup */
lightbox.addEventListener('click', (e) => {
  if (e.target === lightbox) { e.preventDefault(); e.stopImmediatePropagation(); }
}, true);

/* Keyboard: cuma panah kiri/kanan; ESC diblok */
document.addEventListener("keydown", e => {
  if(lightbox.style.display !== "flex") return;
  if(e.key === "ArrowRight") nextImage();
  if(e.key === "ArrowLeft")  prevImage();
  if(e.key === "Escape"){ e.preventDefault(); e.stopImmediatePropagation(); }
});

/* Resize jaga clamp */
window.addEventListener('resize', ()=>{
  if(lightbox.style.display === "flex"){ computeBaseSize(); applyTransform(); }
});

/* Edge slide saat zoom>1 (tarik melewati tepi) */
const EDGE_TRIGGER = 72;   // px
const SLIDE_DUR = 220;     // ms
let edgePull = 0, isSliding = false;

viewport.addEventListener('pointerdown', () => { edgePull = 0; }, true);
viewport.addEventListener('pointermove', (e) => {
  if (zoom === 1 || !isPanning) { edgePull = 0; viewport.classList.remove('can-edge-left','can-edge-right'); return; }
  const intendedX = e.clientX - startPX;
  const maxX = Math.max(0, (baseW*zoom - baseW)/2);
  if (intendedX >  maxX){ edgePull = intendedX -  maxX;  viewport.classList.add('can-edge-right'); viewport.classList.remove('can-edge-left'); }
  else if (intendedX < -maxX){ edgePull = intendedX +  maxX; viewport.classList.add('can-edge-left');  viewport.classList.remove('can-edge-right'); }
  else { edgePull = 0; viewport.classList.remove('can-edge-left','can-edge-right'); }
}, true);
viewport.addEventListener('pointerup', () => {
  if (zoom === 1) { edgePull = 0; return; }
  const pull = edgePull; edgePull = 0;
  viewport.classList.remove('can-edge-left','can-edge-right');
  if (Math.abs(pull) >= EDGE_TRIGGER){
    if (pull < 0) slideTo(+1); else slideTo(-1);
  }
}, true);

async function slideTo(dir){
  if (isSliding) return;
  const screens = document.querySelectorAll('.apk-screenshots img');
  const targetIndex = currentIndex + dir;
  if (targetIndex < 0 || targetIndex >= screens.length) return;

  isSliding = true;
  const src = screens[targetIndex].src;
  const sz = await preload(src);
  naturalW = sz.w; naturalH = sz.h; computeBaseSize();

  const next = currentIsA ? layerB : layerA;
  const curr = currentIsA ? layerA : layerB;

  setLayerBG(next, src);

  next.style.transition = 'none';
  curr.style.transition = 'none';
  next.style.opacity = '1';
  curr.style.opacity = '1';
  next.style.transform = `translateX(${dir*100}%)`;
  curr.style.transform = `translateX(0%)`;
  next.getBoundingClientRect();

  const trans = `transform ${SLIDE_DUR}ms cubic-bezier(.2,.7,.2,1)`;
  next.style.transition = trans; curr.style.transition = trans;
  next.style.transform = 'translateX(0%)';
  curr.style.transform = `translateX(${-dir*100}%)`;

  const onDone = () => {
    next.removeEventListener('transitionend', onDone);
    curr.style.transition = ''; next.style.transition = '';
    curr.style.opacity = '0';
    curr.style.transform = ''; next.style.transform = '';
    currentIsA = !currentIsA;
    currentIndex = targetIndex;
    updateArrows(screens);
    panX = 0; panY = 0; applyTransform();
    isSliding = false;
    prefetchNeighbor();
  };
  next.addEventListener('transitionend', onDone);
}

/* Prefetch kiri/kanan */
function prefetchNeighbor(){
  const screens = document.querySelectorAll('.apk-screenshots img');
  [currentIndex-1, currentIndex+1].forEach(i => {
    if (i >= 0 && i < screens.length){
      const im = new Image(); im.decoding='async'; im.src = screens[i].src;
    }
  });
}

/* Screenshot Loader Fix (kelas .loaded) */
document.querySelectorAll(".apk-screenshots img").forEach(img=>{
  if(img.complete) img.classList.add("loaded");
  else img.addEventListener("load", ()=> img.classList.add("loaded"));
});
</script>
</body>
</html>
